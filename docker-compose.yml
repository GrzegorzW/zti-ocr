version: "2"
services:
    php-fpm:
        build: docker/php-fpm
        volumes:
            - .:/ocr
            - ./docker/php-fpm/php-ini-overrides.ini:/usr/local/etc/php/conf.d/php-ini-overrides.ini
            - ./docker/php-fpm/opcache.ini:/usr/local/etc/php/conf.d/opcache.ini
            - ./docker/php-fpm/agent.ini:/etc/blackfire/agent
            - ./docker/php-fpm/blackfire.ini:/root/.blackfire.ini

    webserver:
        image: nginx
        working_dir: /ocr
        volumes:
            - .:/ocr
            - ./docker/nginx/ocr.conf:/etc/nginx/conf.d/default.conf
            - ./docker/nginx/nginx.conf:/etc/nginx/nginx.conf
        ports:
            - "8090:80"
        depends_on:
            - php-fpm

    db:
        image: mysql:5.7
        volumes:
            - ./docker/data/db:/var/lib/mysql
        restart: always
        ports:
            - "23306:3306"
        environment:
            MYSQL_ROOT_PASSWORD: ocr
            MYSQL_DATABASE: ocr
            MYSQL_USER: ocr
            MYSQL_PASSWORD: ocr

    redis:
        image: redis
        ports:
            - "6379:6379"